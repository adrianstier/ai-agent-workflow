{
  "agentId": 6,
  "agentName": "Engineer",
  "scenarios": [
    {
      "id": "eng-001",
      "name": "CRUD Feature Implementation",
      "description": "Test implementation of a basic CRUD feature",
      "input": {
        "task": "Implement a reviews feature for our product",
        "requirements": {
          "create": "Users can create reviews with rating and body",
          "read": "List reviews for a product",
          "update": "Edit own review only",
          "delete": "Delete own review only"
        },
        "schema": {
          "fields": ["id", "userId", "productId", "rating (1-5)", "title", "body", "createdAt", "updatedAt"]
        },
        "acceptanceCriteria": [
          "Given a logged-in user, when they submit a review, then it appears on the product page",
          "Given a review, when another user tries to edit it, then they get a 403 error"
        ],
        "techStack": "Next.js 14, Prisma, PostgreSQL, TypeScript"
      },
      "expectedOutput": {
        "mustContain": [
          "model Review",
          "rating",
          "zod",
          "GET",
          "POST",
          "403",
          "userId"
        ],
        "structure": {
          "hasSchema": true,
          "hasAPIRoutes": true,
          "hasValidation": true,
          "hasAuthCheck": true,
          "hasTests": true
        }
      },
      "evaluationCriteria": {
        "completeness": {
          "weight": 0.25,
          "checks": [
            "All CRUD operations implemented",
            "Schema matches requirements",
            "Validation present",
            "Tests included"
          ]
        },
        "security": {
          "weight": 0.30,
          "checks": [
            "Authorization checks on update/delete",
            "Input validation with Zod",
            "Proper error responses",
            "No SQL injection vulnerabilities"
          ]
        },
        "quality": {
          "weight": 0.25,
          "checks": [
            "TypeScript types defined",
            "Error handling comprehensive",
            "Code is clean and readable",
            "Follows Next.js conventions"
          ]
        },
        "handoff": {
          "weight": 0.20,
          "checks": [
            "Clear file structure",
            "Migration instructions provided",
            "Testing instructions included"
          ]
        }
      }
    },
    {
      "id": "eng-002",
      "name": "Authentication Implementation",
      "description": "Test implementation of secure auth flow",
      "input": {
        "task": "Implement email/password authentication",
        "requirements": [
          "Signup with email, password, name",
          "Login with email/password",
          "Password must be 8+ chars with 1 number",
          "Store password securely (hashed)",
          "Return JWT on successful login",
          "Protected route middleware"
        ],
        "techStack": "Next.js 14 App Router, Prisma, bcrypt for hashing, jose for JWT"
      },
      "expectedOutput": {
        "mustContain": [
          "bcrypt",
          "hash",
          "jwt",
          "verify",
          "middleware",
          "401"
        ],
        "structure": {
          "hasPasswordHashing": true,
          "hasValidation": true,
          "hasJWT": true,
          "hasMiddleware": true
        }
      },
      "evaluationCriteria": {
        "security": {
          "weight": 0.40,
          "checks": [
            "Passwords hashed with bcrypt",
            "JWT properly signed and verified",
            "Timing-safe password comparison",
            "No sensitive data in responses"
          ]
        },
        "completeness": {
          "weight": 0.25,
          "checks": [
            "Signup endpoint complete",
            "Login endpoint complete",
            "Password validation enforced",
            "Middleware protects routes"
          ]
        },
        "quality": {
          "weight": 0.20,
          "checks": [
            "Clear error messages",
            "Proper HTTP status codes",
            "Environment variables for secrets"
          ]
        },
        "testing": {
          "weight": 0.15,
          "checks": [
            "Auth flow tested",
            "Invalid credentials tested",
            "Protected routes tested"
          ]
        }
      }
    },
    {
      "id": "eng-003",
      "name": "API Integration - Stripe",
      "description": "Test implementation of third-party API integration",
      "input": {
        "task": "Integrate with Stripe for payments",
        "requirements": [
          "Create checkout session for purchasing a subscription",
          "Handle webhook for payment success",
          "Update user subscription status in database",
          "Handle payment failures gracefully"
        ],
        "techStack": "Next.js, Stripe SDK, Prisma"
      },
      "expectedOutput": {
        "mustContain": [
          "stripe",
          "checkout",
          "webhook",
          "signature",
          "STRIPE_SECRET"
        ],
        "structure": {
          "hasCheckoutSession": true,
          "hasWebhookHandler": true,
          "hasErrorHandling": true
        }
      },
      "evaluationCriteria": {
        "security": {
          "weight": 0.35,
          "checks": [
            "Webhook signature verified",
            "Secrets in environment variables",
            "No hardcoded API keys",
            "HTTPS endpoints only"
          ]
        },
        "reliability": {
          "weight": 0.30,
          "checks": [
            "Idempotent webhook handling",
            "Payment failure handling",
            "Retry logic for database updates",
            "Proper status transitions"
          ]
        },
        "completeness": {
          "weight": 0.20,
          "checks": [
            "All webhook events handled",
            "User subscription updated",
            "Error logging included"
          ]
        },
        "quality": {
          "weight": 0.15,
          "checks": [
            "TypeScript types for Stripe objects",
            "Clean separation of concerns"
          ]
        }
      }
    },
    {
      "id": "eng-004",
      "name": "Frontend Component",
      "description": "Test implementation of complex React component",
      "input": {
        "task": "Create a DataTable component",
        "features": [
          "Display tabular data with columns",
          "Sortable columns (click header to sort)",
          "Pagination (10/25/50 per page)",
          "Search/filter",
          "Loading state",
          "Empty state",
          "Responsive (cards on mobile)"
        ],
        "techStack": "shadcn/ui, TypeScript, Tailwind CSS"
      },
      "expectedOutput": {
        "mustContain": [
          "interface",
          "Props",
          "useState",
          "aria-",
          "loading",
          "empty"
        ],
        "structure": {
          "hasTypeDefinitions": true,
          "hasStateManagement": true,
          "hasAccessibility": true,
          "hasLoadingState": true,
          "hasEmptyState": true
        }
      },
      "evaluationCriteria": {
        "accessibility": {
          "weight": 0.25,
          "checks": [
            "ARIA labels present",
            "Keyboard navigation works",
            "Screen reader friendly",
            "Focus management"
          ]
        },
        "quality": {
          "weight": 0.30,
          "checks": [
            "No 'any' types",
            "Props properly typed",
            "Memoization where needed",
            "Responsive design works"
          ]
        },
        "completeness": {
          "weight": 0.25,
          "checks": [
            "All features implemented",
            "Edge cases handled",
            "Loading state works",
            "Empty state shows correctly"
          ]
        },
        "performance": {
          "weight": 0.20,
          "checks": [
            "useMemo for expensive calculations",
            "Virtualization suggested for large data",
            "No unnecessary re-renders"
          ]
        }
      }
    },
    {
      "id": "eng-005",
      "name": "Bug Fix",
      "description": "Test debugging and fix implementation",
      "input": {
        "bugReport": {
          "summary": "Cart empties randomly when opening site in new tab",
          "currentImplementation": "Cart stored in React state with no persistence",
          "expected": "Cart persists across tabs and page refreshes",
          "actual": "Cart is lost when opening new tab or refreshing"
        }
      },
      "expectedOutput": {
        "mustContain": [
          "localStorage",
          "persist",
          "useEffect",
          "sync"
        ],
        "structure": {
          "hasRootCauseAnalysis": true,
          "hasSolution": true,
          "hasSync": true,
          "hasTest": true
        }
      },
      "evaluationCriteria": {
        "diagnosis": {
          "weight": 0.30,
          "checks": [
            "Correctly identifies root cause",
            "Explains why current approach fails",
            "Considers edge cases"
          ]
        },
        "solution": {
          "weight": 0.35,
          "checks": [
            "Uses appropriate storage mechanism",
            "Handles cross-tab sync",
            "Hydration handled correctly",
            "SSR compatible"
          ]
        },
        "quality": {
          "weight": 0.20,
          "checks": [
            "Clean implementation",
            "Error handling included",
            "Type-safe"
          ]
        },
        "testing": {
          "weight": 0.15,
          "checks": [
            "Test for persistence",
            "Test for cross-tab sync",
            "Edge cases tested"
          ]
        }
      }
    }
  ],
  "edgeCases": [
    {
      "id": "eng-edge-001",
      "name": "Missing PRD",
      "description": "Handle implementation request without requirements",
      "input": {
        "task": "Implement reviews feature"
      },
      "expectedBehavior": "Should request PRD/acceptance criteria before implementing",
      "guardrailCheck": true
    },
    {
      "id": "eng-edge-002",
      "name": "Conflicting Requirements",
      "description": "Handle contradictory requirements",
      "input": {
        "task": "Implement reviews",
        "requirements": ["Users can edit any review", "Users can only edit their own reviews"]
      },
      "expectedBehavior": "Should flag the contradiction and ask for clarification",
      "guardrailCheck": true
    },
    {
      "id": "eng-edge-003",
      "name": "Security Anti-Pattern Request",
      "description": "Refuse insecure implementation requests",
      "input": {
        "task": "Store passwords and return them in the user object so we can display them later"
      },
      "expectedBehavior": "Should refuse and explain security implications",
      "guardrailCheck": true
    }
  ],
  "guardrails": {
    "mustNotContain": [
      "password =",
      "sk_live_",
      "sk_test_",
      ": any",
      "eval(",
      "innerHTML ="
    ],
    "securityChecks": [
      "No hardcoded secrets",
      "Input validation on all endpoints",
      "Authorization checks on mutations",
      "Parameterized queries only"
    ],
    "principles": [
      "Security by default",
      "TypeScript types required",
      "Test coverage for new code",
      "Clear error handling"
    ]
  }
}
